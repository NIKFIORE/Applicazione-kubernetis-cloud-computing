apiVersion: apps/v1                     # Versione API
kind: Deployment                        # Tipo di risorsa
metadata:
  name: mongodb                         # Nome del Deployment MongoDB
spec:
  replicas: 1                           # Numero di pod MongoDB
  selector:
    matchLabels:
      app: mongodb                     # Label usata dal selector
  template:
    metadata:
      labels:
        app: mongodb                   # Label del pod
    spec:
      containers:
        - name: mongodb                # Nome del container
          image: mongo:7.0             # Immagine ufficiale MongoDB
          ports:
            - containerPort: 27017     # Porta MongoDB
          env:
            - name: MONGO_INITDB_ROOT_USERNAME   # Username admin MongoDB
              value: admin
            - name: MONGO_INITDB_ROOT_PASSWORD   # Password admin MongoDB
              value: adminpassword
          resources:
            limits:
              cpu: "0.5"               # Limite massimo CPU
              memory: 512Mi             # Limite massimo memoria
            requests:
              cpu: "0.25"              # CPU garantita
              memory: 256Mi             # Memoria garantita
          volumeMounts:
            - name: mongodb-storage    # Volume per persistenza dati
              mountPath: /data/db
            - name: mongodb-init-script # Volume per script di inizializzazione
              mountPath: /docker-entrypoint-initdb.d
      volumes:
        - name: mongodb-storage        # PVC per i dati MongoDB
          persistentVolumeClaim:
            claimName: mongodb-pvc
        - name: mongodb-init-script    # ConfigMap con script di init
          configMap:
            name: mongodb-init
